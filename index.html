<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>MEOW HELLO - The Purrfect Place</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Chewy&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================
          1. CORREZIONE GLOBALE SCORRIMENTO PC
              Rimosso overflow-x superfluo sul body e min-height/overflow
              sugli stati interni.
           ========================================================== */
        html {
            /* Assicura che l'elemento principale prenda tutta l'altezza */
            height: 100%; 
            /* Impedisce lo scorrimento orizzontale superfluo */
            overflow-x: hidden; 
            /* Permette lo scorrimento verticale naturale del documento */
            overflow-y: auto;
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            transition: background-color 0.3s ease;
            /* Garantisce che l'altezza minima sia l'altezza della finestra visibile (viewport) */
            min-height: 100vh; 
            /* Rimosso overflow-x: hidden dal body per evitare conflitti */
        }
        
        /* Assicuriamo che gli stati coprano il 100% dell'altezza minima definita nel body */
        #catMaskState, #shopState, #checkoutState, #orderConfirmationState {
            width: 100%;
            min-height: 100%; /* Si adatta all'altezza minima del body */
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            display: none;
            box-sizing: border-box;
            z-index: 1;
            /* **ATTENZIONE:** Rimosso min-height: 100vh e overflow-y: auto da qui,
                perchÃ© lo scorrimento deve essere gestito dal body/html */
        }

        #catMaskState {
            display: flex;
            opacity: 1;
            background-color: #e0f7fa;
            color: #333;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 20px 20px 50px 20px;
            z-index: 2;
        }
        
        .visible {
            opacity: 1 !important;
            display: block !important; 
        }
        
        #catMaskState.visible {
            display: flex !important;
        }

        #catMaskState.hidden {
            opacity: 0 !important;
            pointer-events: none;
            position: absolute;
        }
        
        #catMaskState-header {
            width: 100%;
            max-width: 1200px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-bottom: 30px;
        }

        #catMaskState-title h1 {
            font-family: 'Chewy', cursive;
            font-size: 4.5em;
            color: #ff99aa;
            margin-bottom: -15px;
            text-align: center;
            text-shadow: 2px 2px 0px #fff;
            cursor: default;
        }

        #catMaskState-title p {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2em;
            color: #66bb6a;
            font-weight: bold;
            text-transform: uppercase;
            margin: 0;
            text-align: center;
        }

        .cat-image-container {
            position: relative;
            max-width: 600px;
            width: 90%;
            margin: 30px auto;
            text-align: center;
        }
        
        .cat-hero-image {
            width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            display: block;
        }
        
        /* SECRET SPOT: The invisible area */
        .secret-spot {
        position: absolute;
        top: 0px;
        right: 0px;
        width: 5px;
        height: 5px;
        cursor: pointer;
        z-index: 10;
        opacity: 0; /* Correggi per essere totalmente invisibile */
        }
        
        /* Products on Cat Mask */
        #maskProducts-container {
            width: 100%;
            max-width: 1000px;
            padding: 20px 0;
            margin-top: 20px;
        }
        
        #maskProducts-container h2 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            font-size: 2em;
        }

        .mask-product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
        }
        
        .mask-product-card {
            background-color: #ffffff;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        /* *** CORREZIONE IMMAGINI PRODOTTI (Cat Mask) *** */
        .mask-product-card img {
            width: 100%;
            height: 180px; 
            /* Object-fit copre il contenitore, eliminando lo spazio bianco */
            object-fit: cover; 
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .mask-product-card h4 {
            color: #555;
            font-size: 0.9em;
        }
        
        .mask-product-card p {
            color: #ff99aa;
            font-weight: bold;
        }
        
        .mask-product-button {
            background-color: #66bb6a;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }


        /* --- SHOP MASK (Neutral/Original Look) --- */
        #shopState {
            background-color: #f4f4f4;
            color: #333;
            padding: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        #shopState h1 {
            font-size: 2.5em;
            color: #1a1a1a;
            text-transform: uppercase;
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid #ccc;
        }

        .cart-icon-container {
            position: relative;
            cursor: pointer;
            padding: 8px 12px;
            background-color: #e0e0e0;
            border-radius: 5px;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .cart-icon {
            font-size: 1.5em;
        }

        #cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #cc0000;
            color: white;
            padding: 2px 6px;
            border-radius: 50%;
            font-size: 0.8em;
            line-height: 1;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
        }

        .product-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #ddd;
        }

        /* *** CORREZIONE IMMAGINI PRODOTTI (Negozio) *** */
        .product-image {
            width: 100%;
            height: 220px; 
            /* Object-fit copre il contenitore, eliminando lo spazio bianco */
            object-fit: cover; 
            display: block;
        }
        
        .product-info {
            padding: 15px;
            text-align: center;
        }

        .product-title {
            font-size: 1.2em;
            margin: 0 0 5px 0;
            color: #333;
        }

        .product-price {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
            margin: 0 0 15px 0;
        }

        .quantity-select {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .add-to-cart-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 1em;
            transition: background-color 0.2s;
        }

        .add-to-cart-button:hover {
            background-color: #0056b3;
        }

        /* MODAL STYLES */
        #cartModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center; /* Allineamento verticale per il pulsante rimuovi */
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-item button { /* Stile per il pulsante Rimuovi */
            background: #ff5252;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 0.8em;
        }

        .checkout-button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            background-color: #28a745;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 20px;
        }
        .checkout-button:hover {
            background-color: #1e7e34;
        }

        /* --- CHECKOUT/CONFIRMATION STATES --- */
        #checkoutState, #orderConfirmationState {
            background-color: #f4f4f4;
            padding: 30px 0;
            display: flex;
            justify-content: center;
            /* Rimosso overflow-y: auto e min-height: 100vh come correzione scroll */
        }

        /* ==========================================================
          2. CORREZIONE CHECKOUT PC: Centratura e Divisione
              Aggiunto margin auto e modificata la flessibilitÃ  delle colonne.
           ========================================================== */
        .checkout-container {
            /* **MODIFICA CRITICA:** Centra il blocco orizzontalmente sul PC */
            margin: 20px auto; 
            display: flex;
            max-width: 1000px;
            /* Utilizziamo il 90% per dare un po' di margine sui lati, specialmente su PC */
            width: 90%; 
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* *** NUOVA DIVISIONE LAYOUT CHECKOUT (60% / 40%) *** */
        .checkout-left {
            /* 60% della larghezza per il Form/Riepilogo */
            flex: 3; 
            padding: 30px;
            background-color: #f8f9fa;
        }

        .checkout-right {
            /* 40% della larghezza per l'Immagine di Sfondo */
            flex: 2; 
            background-image: url('https://i.imgur.com/SyCQXvm.gif');
            background-size: cover;
            background-position: center;
        }
        
        .product-summary-box {
            padding: 20px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 5px;
            height: 100%; 
            box-sizing: border-box;
        }
        
        /* *** CORREZIONE BUG IMMAGINE RIEPILOGO: Aggiunto un wrapper per l'immagine */
        .summary-item-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
        }
        .summary-item-image {
            width: 80px; /* Ridotto per il riepilogo */
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }
        .summary-item-details {
            flex-grow: 1;
        }
        
        .checkout-item-details {
            border-top: 1px solid #eee;
            padding-top: 10px;
            margin-top: 10px;
            line-height: 1.6;
        }

        .submit-order-button, .finish-button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 4px;
            background-color: #28a745;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            margin-top: 15px;
        }
        
        .submit-order-button:last-of-type {
            background-color: #ccc;
            color: #333;
        }
        
        .solana-display {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            padding: 15px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 5px;
        }

        /* ==========================================================
          3. CORREZIONE RESPONSIVE PER IL CHECKOUT SU MOBILE
              Rimossi margini ridondanti per evitare decentramento.
           ========================================================== */
        @media (max-width: 768px) {
            .checkout-container {
                flex-direction: column;
                /* Rimosso margin: 0 10px; (gestito dalla regola principale) */
                width: 95%; /* Leggermente piÃ¹ largo sui mobile */
            }
            /* Su schermi piccoli la colonna destra deve avere un'altezza definita */
            .checkout-right { 
                height: 200px;
                order: -1; /* Sposta l'immagine sopra il contenuto del form */
            }
            
            /* Rimuovi padding verticale eccessivo sullo stato */
            #checkoutState, #orderConfirmationState {
                padding: 10px 0; 
            }

            /* Riduci il padding interno del contenitore principale per risparmiare spazio */
            .checkout-left {
                padding: 15px; 
            }

            /* Riduci il padding della scatola del riepilogo */
            .product-summary-box {
                padding: 10px; 
            }

            /* Riduci la dimensione dei font nelle intestazioni */
            #catMaskState-title h1 {
                font-size: 3em;
            }
            .shop-header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    
    <div class="mask-state" id="catMaskState">
        <div id="catMaskState-header">
            <div id="catMaskState-title">
                <h1>MEOW HELLO</h1>
                <p>The Purrfect Place for Cats & Humans</p>
            </div>
        </div>

        <div class="cat-image-container">
            <img src="https://images.unsplash.com/photo-1543852786-1cf6624b9987?q=80&w=1887&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Cute Cat Looking" class="cat-hero-image">
            <div class="secret-spot" id="secretSpot" title="Secret Area"></div>
        </div>

        <div id="maskProducts-container">
            <h2>KITTY TREASURES</h2>
            <div class="mask-product-grid">
                
                <div class="mask-product-card">
                    <img src="https://secure.img1-cg.wfcdn.com/im/53209099/compr-r85/1946/194642674/royal-luxury-cat-bed.jpg" alt="Cat Bed">
                    <h4>Cloud Bed</h4>
                    <p>Â£15.00</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
                <div class="mask-product-card">
                    <img src="https://i5.walmartimages.com/seo/68-Inches-Multi-Level-Big-Cat-Tree-Tall-Multi-Cats-Tower-2-Big-Cat-Condo-Cat-Hair-Brush-Large-Cat-Tree-3-Padded-Plush-Perches-Scratching-Posts_36502d8b-d810-4e79-ae55-ab2cb39bbb37.3bd7edfea35e7957faaaf757195c748c.jpeg?odnHeight=573&odnWidth=573&odnBg=FFFFFF" alt="Scratching Post">
                    <h4>Climbing Tower</h4>
                    <p>Â£45.00</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
                <div class="mask-product-card">
                    <img src="https://s.alicdn.com/@sc04/kf/Hf18ace0651e24d9395b73c429d962f12L.jpg_300x300.jpg" alt="Food Bowl">
                    <h4>Smart Food Bowl</h4>
                    <p>Â£22.50</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
                <div class="mask-product-card">
                    <img src="https://cdn.shopify.com/s/files/1/2977/2416/products/kit-cat-dry-cat-food-chicken-cuisine_1_3.jpg?v=1571711393" alt="Dry Food">
                    <h4>Salmon Kibble Bag</h4>
                    <p>Â£18.00</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
                <div class="mask-product-card">
                    <img src="https://s.alicdn.com/@sc04/kf/H5899dcc2d46248e4940491160eadf67a0.jpg_300x300.jpg" alt="Cat Treats">
                    <h4>Protein Treats</h4>
                    <p>Â£10.50</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
                <div class="mask-product-card">
                    <img src="https://m.media-amazon.com/images/I/719mzqZYD0L._AC_SX569_.jpg" alt="Carrier">
                    <h4>Travel Carrier</h4>
                    <p>Â£60.00</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
                <div class="mask-product-card">
                    <img src="https://fancyadd.com/cdn/shop/products/13_b7ae2e96-a4c9-479c-adde-afe19057956d.jpg?v=1709911586&width=1445" alt="Luxury House">
                    <h4>Cat House</h4>
                    <p>Â£75.00</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
                <div class="mask-product-card">
                    <img src="https://s.alicdn.com/@sc04/kf/Hb38414939d0d4f5d86fd3797b5612841a.jpg_300x300.jpg" alt="Brush">
                    <h4>De-Shedding Brush</h4>
                    <p>Â£25.00</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
                <div class="mask-product-card">
                    <img src="https://m.media-amazon.com/images/I/51jIv6GPAeL._AC_.jpg" alt="Litter">
                    <h4>Premium Litter Sand</h4>
                    <p>Â£99.00</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
                <div class="mask-product-card">
                    <img src="https://ae-pic-a1.aliexpress-media.com/kf/S1dbbab5c924c4d298ca8186aae2a8ba0h.jpg_960x960q75.jpg_.avif" alt="Clothes">
                    <h4>Winter Coat</h4>
                    <p>Â£30.00</p>
                    <button class="mask-product-button" onclick="tryToEnterShop()">Buy Now</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="shop-state" id="shopState">
        <div class="shop-header">
            <h1>DIRECT NOTES PURCHASE</h1>
            <div class="cart-icon-container" onclick="toggleCart()">
                <div class="cart-icon">ðŸ›’</div>
                <span id="cart-count">0</span>
            </div>
        </div>
        
        <div class="product-grid">
            <div class="product-card" data-id="1" data-name="NOTESLAB Â£100 LNotes" data-price="35.0" data-img="https://i.imgur.com/SAmyk1R.jpeg">
                <img src="https://i.imgur.com/SAmyk1R.jpeg" alt="Â£100 Note Stack" class="product-image">
                <div class="product-info">
                    <h2 class="product-title">NOTESLAB Â£100 LNotes</h2>
                    <p class="product-price">Â£35.0</p>
                    <select class="quantity-select" id="qty-1">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                    <button class="add-to-cart-button" onclick="addToCart(1)">Add to Cart</button>
                </div>
            </div>

            <div class="product-card" data-id="2" data-name="NOTESLAB Â£200 LNotes" data-price="83.0" data-img="https://i.imgur.com/YSGqDKz.png">
                <img src="https://i.imgur.com/YSGqDKz.png" alt="Â£200 Note Stack" class="product-image">
                <div class="product-info">
                    <h2 class="product-title">NOTESLAB Â£200 LNotes</h2>
                    <p class="product-price">Â£83.0</p>
                    <select class="quantity-select" id="qty-2">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                    <button class="add-to-cart-button" onclick="addToCart(2)">Add to Cart</button>
                </div>
            </div>

            <div class="product-card" data-id="3" data-name="NOTESLAB Â£300 LNotes" data-price="119.0" data-img="https://i.imgur.com/Dhv9Hv1.png">
                <img src="https://i.imgur.com/Dhv9Hv1.png" alt="Â£300 Note Stack" class="product-image">
                <div class="product-info">
                    <h2 class="product-title">NOTESLAB Â£300 LNotes</h2>
                    <p class="product-price">Â£119.0</p>
                    <select class="quantity-select" id="qty-3">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                    <button class="add-to-cart-button" onclick="addToCart(3)">Add to Cart</button>
                </div>
            </div>

            <div class="product-card" data-id="4" data-name="NOTESLAB Â£500 LNotes" data-price="192.0" data-img="https://i.imgur.com/rretgZm.png">
                <img src="https://i.imgur.com/rretgZm.png" alt="Â£500 Note Stack" class="product-image">
                <div class="product-info">
                    <h2 class="product-title">NOTESLAB Â£500 LNotes</h2>
                    <p class="product-price">Â£192.0</p>
                    <select class="quantity-select" id="qty-4">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                    <button class="add-to-cart-button" onclick="addToCart(4)">Add to Cart</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="checkoutState">
        <div class="checkout-container">
            <div class="checkout-left">
                <form id="checkoutForm">
                    <h2>Shipping & Payment</h2>
                    <label for="solanaAddress" style="display: block; margin-bottom: 5px; font-weight: bold;">Solana Address:</label>
                    <input type="text" id="solanaAddress" name="solanaAddress" placeholder="Enter your Solana wallet address" required style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 4px;">

                    <h3>Payment Details</h3>
                    <div class="solana-display">
                        <p>Total in GBP: Â£<span id="checkout-total-gbp">0.00</span></p>
                        <p>Pay with Solana: <span id="checkout-total-solana">0.00</span> SOL</p>
                    </div>

                    <button type="submit" class="submit-order-button" id="submitOrderButton">Place Order & Get SOL Address</button>
                    <button type="button" class="submit-order-button" onclick="showShop()">Back to Shop</button>
                </form>
            </div>
            
            <div class="checkout-right">
            </div>
        </div>
    </div>

    <div id="orderConfirmationState">
        <div class="checkout-container">
            <div class="checkout-left">
                <div class="product-summary-box" style="padding: 30px;">
                    <h2 style="color: #28a745;">Order Confirmation</h2>
                    
                    <div id="order-details-content">
                        </div>

                    <p style="margin-top: 25px; font-weight: bold; color: #333; border-top: 1px solid #eee; padding-top: 15px;">
                        Send your order number to @e_eeppa.
                    </p>

                    <button class="finish-button" onclick="finalizeOrder()">Back to Shop</button>
                </div>
            </div>
            
            <div class="checkout-right">
            </div>
        </div>
    </div>

    <div id="cartModal" style="display: none;">
        <div class="modal-content">
            <span class="close-button" onclick="toggleCart()" style="float: right; font-size: 2em; line-height: 0.8; cursor: pointer;">&times;</span>
            <h2>Your Cart</h2>
            <div id="cart-items-container">
            </div>
            <p style="text-align: right; font-weight: bold; margin-top: 15px;">Total: Â£<span id="cart-total">0.00</span></p>
            <button class="checkout-button" onclick="checkout()">Proceed to Checkout</button>
        </div>
    </div>
    
    <script>
Â  Â  Â  Â  const secretSpot = document.getElementById('secretSpot');
Â  Â  Â  Â  const catMaskState = document.getElementById('catMaskState');
Â  Â  Â  Â  const shopState = document.getElementById('shopState');
Â  Â  Â  Â  const checkoutState = document.getElementById('checkoutState');
Â  Â  Â  Â  const orderConfirmationState = document.getElementById('orderConfirmationState');
Â  Â  Â  Â  const cartModal = document.getElementById('cartModal');
Â  Â  Â  Â  const cartCount = document.getElementById('cart-count');
Â  Â  Â  Â  const cartItemsContainer = document.getElementById('cart-items-container');
Â  Â  Â  Â  const cartTotalDisplay = document.getElementById('cart-total');
Â  Â  Â  Â  const checkoutTotalGBP = document.getElementById('checkout-total-gbp');
Â  Â  Â  Â  const checkoutTotalSolana = document.getElementById('checkout-total-solana');
Â  Â  Â  Â  const checkoutForm = document.getElementById('checkoutForm');
Â  Â  Â  Â  const orderDetailsContent = document.getElementById('order-details-content');

Â  Â  Â  Â  let cart = [];
Â  Â  Â  Â  let secretAreaActive = true;
Â  Â  Â  Â  let lastOrder = null; // Memorizza l'ultimo ordine per la conferma
Â  Â  Â  Â  
Â  Â  Â  Â  // **ATTENZIONE:** Il percorso deve includere il nome del repository per GitHub Pages.
Â  Â  Â  Â  const GLOBAL_STATUS_URL = '/It-s-Just-a-Cat-Shop/shop_status.json';
Â  Â  Â  Â  const OWNER_SHUTDOWN_KEY = 'YOUR_SECRET_CLOSURE_KEY_12345'; // CHIAVE CHE SOLO TU DEVI CONOSCERE

Â  Â  Â  Â  // Tasso di conversione (Esempio: 1 SOL = 66.66 GBP. 1 GBP = 0.015 SOL)
Â  Â  Â  Â  const SOLANA_RATE_PER_GBP = 0.015; 
Â  Â  Â  Â  // CORREZIONE BUG: La funzione convertToSolana deve dividere, non moltiplicare
Â  Â  Â  Â  function convertToSolana(gbpAmount) { 
Â  Â  Â  Â  Â  Â  // Assumo che SOLANA_RATE_PER_GBP sia il rapporto SOL/GBP (es. 0.015 SOL per 1 GBP)
Â  Â  Â  Â  Â  Â  return (gbpAmount * (1/SOLANA_RATE_PER_GBP)).toFixed(6); 
Â  Â  Â  Â  } 
Â  Â  Â  Â  
Â  Â  Â  Â  function generateOrderNumber() { return 'ORD-' + Math.floor(Math.random() * 90000000 + 10000000); }
Â  Â  Â  Â  
Â  Â  Â  Â  function getProductInfo(id) {
Â  Â  Â  Â  Â  Â  const card = document.querySelector(`.product-card[data-id="${id}"]`);
Â  Â  Â  Â  Â  Â  if (!card) return null;
Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  id: id,
Â  Â  Â  Â  Â  Â  Â  Â  name: card.getAttribute('data-name'),
Â  Â  Â  Â  Â  Â  Â  Â  price: parseFloat(card.getAttribute('data-price')),
Â  Â  Â  Â  Â  Â  Â  Â  img: card.getAttribute('data-img')
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  Â  Â 
Â  Â  Â  Â  // --- GESTIONE CAMBIAMENTO STATO (PAGINA) ---

Â  Â  Â  Â  function hideAllStates() {
Â  Â  Â  Â  Â  Â  [catMaskState, shopState, checkoutState, orderConfirmationState].forEach(state => {
Â  Â  Â  Â  Â  Â  Â  Â  state.classList.remove('visible');
Â  Â  Â  Â  Â  Â  Â  Â  state.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  // Rimuovi il display:block/flex dopo la transizione (opzionale, ma pulisce)
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  }, 500); 
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  cartModal.style.display = 'none'; // Assicura che la modale sia chiusa
Â  Â  Â  Â  }

Â  Â  Â  Â  // Funzione per tornare in modo pulito alla Cat Mask (Stato Default)
Â  Â  Â  Â  function showCatMask() {
Â  Â  Â  Â  Â  Â  hideAllStates();
Â  Â  Â  Â  Â  Â  catMaskState.style.display = 'flex'; // Riattiviamo la visualizzazione in flex
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  catMaskState.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  catMaskState.classList.add('visible');
Â  Â  Â  Â  Â  Â  }, 10);
Â  Â  Â  Â  }

Â  Â  Â  Â  // Funzione per accedere allo Shop segreto
Â  Â  Â  Â  function showShop() {
Â  Â  Â  Â  Â  Â  if (!secretAreaActive) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("The secure notes access is currently suspended globally.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  hideAllStates();
Â  Â  Â  Â  Â  Â  // Usiamo 'block' per lo shop, per non forzare flex/grid sul body
Â  Â  Â  Â  Â  Â  shopState.style.display = 'block'; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Forza lo scroll in alto per un'esperienza piÃ¹ pulita
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0); 

Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  shopState.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  shopState.classList.add('visible');
Â  Â  Â  Â  Â  Â  Â  Â  renderCart(); // Aggiorna il carrello dopo il cambio di stato
Â  Â  Â  Â  Â  Â  }, 10);
Â  Â  Â  Â  }

Â  Â  Â  Â  // La funzione tryToEnterShop Ã¨ usata dai pulsanti "Buy Now" della maschera
Â  Â  Â  Â  window.tryToEnterShop = function() {
Â  Â  Â  Â  Â  Â  if (!secretAreaActive) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("The Kitty Shop is temporarily out of stock. Secure notes purchase has been suspended globally.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  alert("Oops! This item is currently unavailable. Please check our exclusive selection inside.");
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- LOGICA CARRELLO ---

Â  Â  Â  Â  function updateCartTotal() {
Â  Â  Â  Â  Â  Â  const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
Â  Â  Â  Â  Â  Â  cartTotalDisplay.textContent = total.toFixed(2);
Â  Â  Â  Â  Â  Â  cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
Â  Â  Â  Â  Â  Â  return total;
Â  Â  Â  Â  }

Â  Â  Â  Â  window.addToCart = function(productId) {
Â  Â  Â  Â  Â  Â  if (!secretAreaActive) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("The store is temporarily closed.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const info = getProductInfo(productId);
Â  Â  Â  Â  Â  Â  const quantityInput = document.getElementById(`qty-${productId}`);
Â  Â  Â  Â  Â  Â  const quantity = parseInt(quantityInput ? quantityInput.value : 1);

Â  Â  Â  Â  Â  Â  if (!info || quantity < 1) return;

Â  Â  Â  Â  Â  Â  const existingItem = cart.find(item => item.id === productId);

Â  Â  Â  Â  Â  Â  if (existingItem) {
Â  Â  Â  Â  Â  Â  Â  Â  existingItem.quantity += quantity;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  cart.push({ ...info, quantity });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  updateCartTotal();
Â  Â  Â  Â  Â  Â  alert(`${quantity} x ${info.name} added to cart!`);
Â  Â  Â  Â  }

Â  Â  Â  Â  window.removeFromCart = function(productId) {
Â  Â  Â  Â  Â  Â  cart = cart.filter(item => item.id !== productId);
Â  Â  Â  Â  Â  Â  renderCart();
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderCart() {
Â  Â  Â  Â  Â  Â  cartItemsContainer.innerHTML = '';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (cart.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  cartItemsContainer.innerHTML = '<p style="text-align: center; color: #777;">Your cart is empty.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('#cartModal .checkout-button').disabled = true;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  cart.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.classList.add('cart-item');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemDiv.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${item.name} (${item.quantity})</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>Â£${(item.price * item.quantity).toFixed(2)} 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="removeFromCart(${item.id})">Remove</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cartItemsContainer.appendChild(itemDiv);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('#cartModal .checkout-button').disabled = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  updateCartTotal();
Â  Â  Â  Â  }

Â  Â  Â  Â  window.toggleCart = function() {
Â  Â  Â  Â  Â  Â  if (cartModal.style.display === 'flex') {
Â  Â  Â  Â  Â  Â  Â  Â  cartModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  renderCart();
Â  Â  Â  Â  Â  Â  Â  Â  cartModal.style.display = 'flex';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- LOGICA CHECKOUT ---
Â  Â  Â  Â  
Â  Â  Â  Â  window.checkout = function() {
Â  Â  Â  Â  Â  Â  if (cart.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  alert("The cart is empty.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 1. Passa allo stato di Checkout
Â  Â  Â  Â  Â  Â  hideAllStates();
Â  Â  Â  Â  Â  Â  checkoutState.style.display = 'flex';
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0); 
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  checkoutState.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  checkoutState.classList.add('visible');
Â  Â  Â  Â  Â  Â  }, 10);

Â  Â  Â  Â  Â  Â  // 2. Calcola i totali e li aggiorna
Â  Â  Â  Â  Â  Â  const totalGBP = updateCartTotal();
Â  Â  Â  Â  Â  Â  const totalSOL = convertToSolana(totalGBP);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  checkoutTotalGBP.textContent = totalGBP.toFixed(2);
Â  Â  Â  Â  Â  Â  checkoutTotalSolana.textContent = totalSOL;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // 3. Aggiunge il riepilogo nell'area sinistra (facoltativo, ma utile)
Â  Â  Â  Â  Â  Â  // Per coerenza visiva, lo metto subito prima del form
Â  Â  Â  Â  Â  Â  const summaryHTML = cart.map(item => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-item-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${item.img}" alt="${item.name}" class="summary-item-image">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-item-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-weight: bold; margin: 0;">${item.name}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 0; font-size: 0.9em;">Qty: ${item.quantity} | Total: Â£${(item.price * item.quantity).toFixed(2)}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Crea un elemento per il riepilogo da inserire nel div.checkout-left
Â  Â  Â  Â  Â  Â  let summaryBox = document.getElementById('checkoutSummaryBox');
Â  Â  Â  Â  Â  Â  if (!summaryBox) {
Â  Â  Â  Â  Â  Â  Â  Â  summaryBox = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  summaryBox.id = 'checkoutSummaryBox';
Â  Â  Â  Â  Â  Â  Â  Â  summaryBox.classList.add('product-summary-box');
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.checkout-left').prepend(summaryBox);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  summaryBox.innerHTML = `<h3>Order Summary:</h3>${summaryHTML}`;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Gestione della sottomissione del form
Â  Â  Â  Â  checkoutForm.addEventListener('submit', function(e) {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const solanaAddress = document.getElementById('solanaAddress').value.trim();
Â  Â  Â  Â  Â  Â  if (solanaAddress === "") {
Â  Â  Â  Â  Â  Â  Â  Â  alert("Please enter your Solana address.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  lastOrder = {
Â  Â  Â  Â  Â  Â  Â  Â  orderId: generateOrderNumber(),
Â  Â  Â  Â  Â  Â  Â  Â  items: JSON.parse(JSON.stringify(cart)), // Copia profonda del carrello
Â  Â  Â  Â  Â  Â  Â  Â  totalGBP: updateCartTotal(),
Â  Â  Â  Â  Â  Â  Â  Â  totalSOL: checkoutTotalSolana.textContent,
Â  Â  Â  Â  Â  Â  Â  Â  solanaAddress: solanaAddress
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  showConfirmation();
Â  Â  Â  Â  });

Â  Â  Â  Â  // Funzione per mostrare la conferma dell'ordine
Â  Â  Â  Â  function showConfirmation() {
Â  Â  Â  Â  Â  Â  if (!lastOrder) return;

Â  Â  Â  Â  Â  Â  hideAllStates();
Â  Â  Â  Â  Â  Â  orderConfirmationState.style.display = 'flex';
Â  Â  Â  Â  Â  Â  window.scrollTo(0, 0); 
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  orderConfirmationState.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  orderConfirmationState.classList.add('visible');
Â  Â  Â  Â  Â  Â  }, 10);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Genera il contenuto della conferma
Â  Â  Â  Â  Â  Â  const itemsSummary = lastOrder.items.map(item => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-item-wrapper" style="border-bottom: 1px dashed #eee;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="${item.img}" alt="${item.name}" class="summary-item-image">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="summary-item-details">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-weight: bold; margin: 0; color: #333;">${item.name} x ${item.quantity}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="margin: 0; font-size: 0.9em; color: #666;">Total: Â£${(item.price * item.quantity).toFixed(2)}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `).join('');

Â  Â  Â  Â  Â  Â  orderDetailsContent.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Order Number:</strong> <span style="color: #007bff; font-size: 1.1em;">${lastOrder.orderId}</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Total Paid:</strong> <span style="color: #28a745;">Â£${lastOrder.totalGBP.toFixed(2)}</span> (${lastOrder.totalSOL} SOL)</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Payment Address:</strong> <code style="word-break: break-all; background: #eee; padding: 2px 5px; border-radius: 3px;">3gY7YgL7Pj6R4yX9nFf9Sj5Z4C8D2b1A6E3H7</code></p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Your Solana Address:</strong> <code style="word-break: break-all; background: #eee; padding: 2px 5px; border-radius: 3px;">${lastOrder.solanaAddress}</code></p>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 10px;">Items Ordered:</h4>
Â  Â  Â  Â  Â  Â  Â  Â  ${itemsSummary}
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  cart = []; // Svuota il carrello dopo l'ordine
Â  Â  Â  Â  Â  Â  updateCartTotal(); // Aggiorna il contatore
Â  Â  Â  Â  }

Â  Â  Â  Â  // Funzione per tornare al punto di partenza dopo la conferma
Â  Â  Â  Â  window.finalizeOrder = function() {
Â  Â  Â  Â  Â  Â  lastOrder = null;
Â  Â  Â  Â  Â  Â  showCatMask();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- LOGICA DI CONTROLLO GLOBALE (Anti-Caching) ---

Â  Â  Â  Â  // NUOVA FUNZIONE: Usa XHR per forzare il bypass della cache
Â  Â  Â  Â  function checkGlobalStatus() {
Â  Â  Â  Â  Â  Â  if (!secretAreaActive) return;

Â  Â  Â  Â  Â  Â  // Aggiungiamo un parametro casuale all'URL per bypassare la cache
Â  Â  Â  Â  Â  Â  const url = GLOBAL_STATUS_URL + '?nocache=' + new Date().getTime();
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const xhr = new XMLHttpRequest();
Â  Â  Â  Â  Â  Â  xhr.open('GET', url, true);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // Forziamo le intestazioni per prevenire la cache
Â  Â  Â  Â  Â  Â  xhr.setRequestHeader("Cache-Control", "no-cache, no-store, must-revalidate");
Â  Â  Â  Â  Â  Â  xhr.setRequestHeader("Pragma", "no-cache");
Â  Â  Â  Â  Â  Â  xhr.setRequestHeader("Expires", "0");

Â  Â  Â  Â  Â  Â  xhr.onreadystatechange = function() {
Â  Â  Â  Â  Â  Â  Â  Â  if (xhr.readyState === 4 && xhr.status === 200) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(xhr.responseText);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.status === 'closed') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  executeGlobalShutdown();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  secretAreaActive = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Errore nel parsing dello stato globale:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  xhr.send();
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Funzione per eseguire la chiusura immediata e forzata
Â  Â  Â  Â  function executeGlobalShutdown() {
Â  Â  Â  Â  Â  Â  if (!secretAreaActive) return;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  secretAreaActive = false;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 1. RIMUOVE IL PUNTO DI ACCESSO
Â  Â  Â  Â  Â  Â  if (secretSpot) {
Â  Â  Â  Â  Â  Â  Â  Â  secretSpot.removeEventListener('click', showShop);
Â  Â  Â  Â  Â  Â  Â  Â  secretSpot.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 2. FORZA IL RITORNO ALLA MASCHERA (per chiunque sia nel negozio segreto)
Â  Â  Â  Â  Â  Â  if (shopState.classList.contains('visible') || checkoutState.classList.contains('visible') || orderConfirmationState.classList.contains('visible')) {
Â  Â  Â  Â  Â  Â  Â  Â  showCatMask(); // Passa allo stato iniziale della Cat Mask
Â  Â  Â  Â  Â  Â  Â  Â  alert("The secure notes access has been suspended globally.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // 3. Blocca l'accesso futuro dai pulsanti "Buy Now"
Â  Â  Â  Â  Â  Â  window.tryToEnterShop = function() {
Â  Â  Â  Â  Â  Â  Â  Â  alert("The Kitty Shop is temporarily out of stock. Secure notes purchase has been suspended globally.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- INIZIALIZZAZIONE ---
Â  Â  Â  Â  
Â  Â  Â  Â  // 1. Gestione click sul punto segreto
Â  Â  Â  Â  if (secretSpot) {
Â  Â  Â  Â  Â  Â  secretSpot.addEventListener('click', showShop);
Â  Â  Â  Â  }

Â  Â  Â  Â  // 2. Avvia il controllo dello stato globale
Â  Â  Â  Â  // Controllo iniziale
Â  Â  Â  Â  checkGlobalStatus();
Â  Â  Â  Â  // Controllo ripetuto ogni 10 secondi per forzare l'aggiornamento
Â  Â  Â  Â  setInterval(checkGlobalStatus, 10000); 

Â  Â  Â  Â  // 3. Mostra lo stato iniziale (la Cat Mask)
Â  Â  Â  Â  showCatMask();

Â  Â  </script>
</body>
</html>

